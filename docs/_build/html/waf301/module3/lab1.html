<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>Lab 3.1: Build, Test and Deploy Juice-shop Web App Staging ENV via Gitlab CI/CD</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="Lab 3.1: Build, Test and Deploy Juice-shop Web App Staging ENV via Gitlab CI/CD"/>
  <meta name="product" content="F5 Web Application Firewall Solutions"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="2023-05-04 07:11:03"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="F5 Web Application Firewall Solutions" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lab 3.1: Build, Test and Deploy Juice-shop Web App Staging ENV via Gitlab CI/CD &#8212; F5 Web Application Firewall Solutions  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/f5.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/f5-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/CoveoFullSearch.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/21fb8a09c3.css" type="text/css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Lab 3.2: Apply WAF suggestions for trusted traffic" href="lab2.html" />
    <link rel="prev" title="Module 3: Pipeline integration (SRE)" href="module3.html" /> 
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="sidebar" class="section-nav">
      
      <!--  version selector ------------------>
      <div id="version_selector_wrapper">
      </div>
      <nav class="nav-sidebartoc">

        
         <h5>F5 Web Application Firewall Solutions  </h5>
        

        <hr>
        <span class="nav-sidebartoc">
            <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../waf102/waf102.html">WAF 102 - Getting started with WAF, Bot Detection and Threat Campaigns</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../waf111/waf111.html">WAF 111 - Protecting Yourself Against the OWASP Top 10</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../waf201/waf201.html">WAF 201 – Elevated WAF Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../waf2023/waf2023.html">WAF 101 - BIG-IP Security:  Mitigating App Vulnerabilities with AWAF</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../waf301.html">WAF 301 - AWAF in a CI/CD Pipeline (Self Guided)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../waf301.html#intro">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../waf301.html#awaf-policy-overview">AWAF policy overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../waf301.html#chatops">ChatOps</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../waf301.html#lab-structure">Lab structure</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../labinfo/labinfo.html">Lab Environment &amp; Topology</a></li>
<li class="toctree-l3"><a class="reference internal" href="../module1/module1.html">Module 1: AWAF Policy Template Creation on BIG-IP (secops engineer)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../module2/module2.html">Module 2: Policy testing - Intro to f5 WAF Tester (secops engineer)</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="module3.html">Module 3: Pipeline integration (SRE)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../waf302/waf302.html">WAF 302 - Enabling API Protection with APM and AWAF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../waf341/waf341.html">WAF 341 – Advanced Protection and Positive Security (Self Guided)</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


    <div id="right-sidebar">
      <h7 style="font-weight:normal">On this page:</h7>
      <nav class="nav-sidebartoc">
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">Lab 3.1: Build, Test and Deploy Juice-shop Web App Staging ENV via Gitlab CI/CD</a><ul>
<li><a class="reference internal" href="#staging-pipeline">Staging Pipeline</a><ul>
<li><a class="reference internal" href="#open-gitlab">3.1.1 Open GitLab</a></li>
<li><a class="reference internal" href="#run-staging-pipeline">3.1.2 Run Staging Pipeline</a></li>
<li><a class="reference internal" href="#pipeline-progress-and-fail-about-2-3-minutes">3.1.3 Pipeline progress and fail (about 2-3 minutes)</a></li>
<li><a class="reference internal" href="#optional-manually-test-waf-policy-for-trusted-traffic">3.1.4 OPTIONAL: Manually test WAF Policy for trusted traffic</a></li>
<li><a class="reference internal" href="#review-policy-suggestions">3.1.5 Review policy suggestions</a></li>
<li><a class="reference internal" href="#examine-awaf-suggestions-through-the-gui">3.1.6 Examine AWAF suggestions through the GUI</a></li>
</ul>
</li>
</ul>
</li>
</ul>

         </span>
      </nav>
    </div>





  
  <div class="main active" id="content" >
    <article class="docs-container site-article-inner">
              <!-- custom breadcrumb -->
        <h5>
            <a href="../../index.html">F5 Web Application Firewall Solutions</a>
              &gt; <a href="../waf301.html">WAF 301 - AWAF in a CI/CD Pipeline (Self Guided)</a>
              &gt; <a href="module3.html">Module 3: Pipeline integration (SRE)</a>

          <span class="right">
             <a href="../../_sources/waf301/module3/lab1.rst.txt" rel="nofollow">Source</a> |
             <a href="https://github.com/f5devcentral/f5-agility-labs-waf">Edit on <i class="fa fa-github" aria-hidden="true"></i></a>
          </span>
        </h5>
        <!-- end custom breadcrumb -->
      


    <!--a title="Export PDF" id="export-pdf" class="btn btn btn-link pull-right">View PDF</a-->
    <button type="button" id="export-pdf" class="btn btn-link right">PDF</button>


    
     
         <div class="sidebar" id="version-warning" style="display: none;">
           <p class="first sidebar-title">
           <span class="icon fa fa-info-circle fa-lg"></span> Version notice:</p>
           <p class="last" id="currentVersion"></p>
          </div>


     <div role="main">
        
  <div class="section" id="lab-3-1-build-test-and-deploy-juice-shop-web-app-staging-env-via-gitlab-ci-cd">
<h1>Lab 3.1: Build, Test and Deploy Juice-shop Web App Staging ENV via Gitlab CI/CD<a class="headerlink" href="#lab-3-1-build-test-and-deploy-juice-shop-web-app-staging-env-via-gitlab-ci-cd" title="Permalink to this heading">¶</a></h1>
<div class="section" id="staging-pipeline">
<h2>Staging Pipeline<a class="headerlink" href="#staging-pipeline" title="Permalink to this heading">¶</a></h2>
<p>We are starting with a staging pipeline that will build the app and deploy it to the staging environment.
the pipeline is built from the <strong>master</strong> branch.
Here are the highlevel stages we are going to execute:</p>
<img alt="../../_images/pipeline_overview.png" src="../../_images/pipeline_overview.png" />
<div class="section" id="open-gitlab">
<h3>3.1.1 Open GitLab<a class="headerlink" href="#open-gitlab" title="Permalink to this heading">¶</a></h3>
<p>In the linux client RDP session open Firefox and click gitlab from the waf-342 favorites folder</p>
<p><span class="guilabel">client RDP</span> -&gt; <span class="guilabel">firefox</span> -&gt; <span class="guilabel">waf-301</span> -&gt; <span class="guilabel">GitLab</span></p>
<p>Click on <span class="guilabel">waflabs / waf_cicd</span> Project</p>
<img alt="../../_images/project_wafcicd.png" src="../../_images/project_wafcicd.png" />
</div>
<div class="section" id="run-staging-pipeline">
<h3>3.1.2 Run Staging Pipeline<a class="headerlink" href="#run-staging-pipeline" title="Permalink to this heading">¶</a></h3>
<p>Navigate to <span class="guilabel">CI / CD</span> -&gt; <span class="guilabel">Pipelines</span> and click on <span class="guilabel">Run Pipeline</span></p>
<img alt="../../_images/run_pipeline.png" src="../../_images/run_pipeline.png" />
<p>Then click on <span class="guilabel">Run pipeline</span></p>
<img alt="../../_images/run_pipeline_button.png" src="../../_images/run_pipeline_button.png" />
</div>
<div class="section" id="pipeline-progress-and-fail-about-2-3-minutes">
<h3>3.1.3 Pipeline progress and fail (about 2-3 minutes)<a class="headerlink" href="#pipeline-progress-and-fail-about-2-3-minutes" title="Permalink to this heading">¶</a></h3>
<p>Watch the pipeline as it progresses through its stages. You can see the output of individual stages by clicking on the corresponding Job in the pipeline.</p>
<p>It is <strong>expected</strong> that the pipeline will fail for the first time. This is due to the WAF Policy being too strict and not allowing <cite>Trusted Traffic</cite> through.
Click on <span class="guilabel">Trusted traffic</span> Job to see more details about the failure</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Functionality tests job sends 3 requests to validate that WAF Policy allows for retrieval of YAML, JSON and .bak extension files, as those are used by users of the app.
Original policy uses ‘POLICY_TEMPLATE_RAPID_DEPLOYMENT’ template which blocks such requests if they are not included in modifications section of the policy.</p>
</div>
<img alt="../../_images/pipeline_fail.png" src="../../_images/pipeline_fail.png" />
</div>
<div class="section" id="optional-manually-test-waf-policy-for-trusted-traffic">
<h3>3.1.4 OPTIONAL: Manually test WAF Policy for trusted traffic<a class="headerlink" href="#optional-manually-test-waf-policy-for-trusted-traffic" title="Permalink to this heading">¶</a></h3>
<p>With automated WAF Policy testing built into the pipeline there is no need to run any manual testing,
for learning purposes you can send the ‘trusted traffic’, check the response and check the AWAF logs.
in the client linux terminal:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl http://10.1.10.150/ftp/packages.json -v</span>
<span class="go">curl http://10.1.10.150/ftp/errors.yml -v</span>
<span class="go">curl http://10.1.10.150/ftp/security_report.json.bak -v</span>
</pre></div>
</div>
<p>The expected result should look something like the following: (AWAF default blocking page)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&lt;html&gt;&lt;head&gt;&lt;title&gt;Request Rejected&lt;/title&gt;&lt;/head&gt;&lt;body&gt;The requested URL was rejected. Please consult with your administrator.&lt;br&gt;&lt;br&gt;Your support ID is: 15023059139070787972&lt;br&gt;&lt;br&gt;&lt;a href=&#39;javascript:history.back();&#39;&gt;[Go Back]&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="review-policy-suggestions">
<h3>3.1.5 Review policy suggestions<a class="headerlink" href="#review-policy-suggestions" title="Permalink to this heading">¶</a></h3>
<p>At this point it’s necessary to update WAF Policy to allow for trusted traffic to pass through.</p>
<p>AWAF generates suggestions based on the ‘policy builder’.when working with AWAF in a pipeline policy builder will mainly be used to ‘relax’ the policy and disable restrictions.</p>
</div>
<div class="section" id="examine-awaf-suggestions-through-the-gui">
<h3>3.1.6 Examine AWAF suggestions through the GUI<a class="headerlink" href="#examine-awaf-suggestions-through-the-gui" title="Permalink to this heading">¶</a></h3>
<ol class="arabic simple">
<li>Open the bigip GUI <span class="guilabel">firefox</span> -&gt; <span class="guilabel">bigip01</span></li>
<li>Verify that you are looking at <span class="guilabel">juiceshop_waf_policy_staging</span> policy under the <span class="guilabel">staging</span> partition</li>
<li>Navigate to ‘traffic learning’ <span class="guilabel">security</span> -&gt; <span class="guilabel">application security</span> -&gt; <span class="guilabel">policy building</span> -&gt; <span class="guilabel">traffic learning</span></li>
<li>Review the suggestions</li>
</ol>
<p>Question - Why did the request to <a class="reference external" href="http://10.1.10.150/ftp/packages.json">http://10.1.10.150/ftp/packages.json</a> get blocked? What is the required policy change?</p>
<img alt="../../_images/policy_learning.png" src="../../_images/policy_learning.png" />
<p>What’s Next?</p>
<p><a class="reference internal" href="lab2.html"><span class="doc">Apply WAF Policy Suggestions</span></a></p>
</div>
</div>
</div>


     </div>
    
     <div class="row next-prev-btn-row">
       <div class="col-lg-12">
       
        <a href="module3.html" title="Module 3: Pipeline integration (SRE)" accesskey="p" class="btn btn-primary left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
       
       
          <a href="lab2.html" title="Lab 3.2: Apply WAF suggestions for trusted traffic" accesskey="n" class="btn btn-primary right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
       
     </div>
     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../_static/js/index.js"></script>
  <script src="../../_static/js/jquery.appear.js"></script>
  <script src="../../_static/js/printThis.js"></script>
  <script src="../../_static/js/bootstrap.min.js"></script>
  <script src="../../_static/js/clouddocs.js"></script>
  <script src="../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
  </body>
</html>