<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>Lab 2: Intro to Positive Security</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="Lab 2: Intro to Positive Security"/>
  <meta name="product" content="F5 Web Application Firewall Solutions"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="2023-05-04 07:11:03"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="F5 Web Application Firewall Solutions" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lab 2: Intro to Positive Security &#8212; F5 Web Application Firewall Solutions  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" href="../../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/f5.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/f5-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/CoveoFullSearch.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/21fb8a09c3.css" type="text/css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Module 3: Layer 7 DoS Protection" href="../../module3-L7-dos/module3.html" />
    <link rel="prev" title="Module 2: Intro to Positive Security" href="../module2.html" /> 
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="sidebar" class="section-nav">
      
      <!--  version selector ------------------>
      <div id="version_selector_wrapper">
      </div>
      <nav class="nav-sidebartoc">

        
         <h5>F5 Web Application Firewall Solutions  </h5>
        

        <hr>
        <span class="nav-sidebartoc">
            <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../waf102/waf102.html">WAF 102 - Getting started with WAF, Bot Detection and Threat Campaigns</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../waf111/waf111.html">WAF 111 - Protecting Yourself Against the OWASP Top 10</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../waf201.html">WAF 201 – Elevated WAF Security</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../labinfo/labinfo.html">Lab Environment &amp; Topology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../module1-elevated-bot/module1.html">Module 1: Elevated Bot Defense</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../module2.html">Module 2: Intro to Positive Security</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Lab 2: Intro to Positive Security</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../module3-L7-dos/module3.html">Module 3: Layer 7 DoS Protection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../module4-login-protect/module4.html">Module 4: Login Page Protection</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../waf2023/waf2023.html">WAF 101 - BIG-IP Security:  Mitigating App Vulnerabilities with AWAF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../waf301/waf301.html">WAF 301 - AWAF in a CI/CD Pipeline (Self Guided)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../waf302/waf302.html">WAF 302 - Enabling API Protection with APM and AWAF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../waf341/waf341.html">WAF 341 – Advanced Protection and Positive Security (Self Guided)</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


    <div id="right-sidebar">
      <h7 style="font-weight:normal">On this page:</h7>
      <nav class="nav-sidebartoc">
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">Lab 2: Intro to Positive Security</a><ul>
<li><a class="reference internal" href="#allow-list">Allow List</a></li>
<li><a class="reference internal" href="#configure-the-virtual-server">Configure the Virtual Server</a></li>
<li><a class="reference internal" href="#exercise-the-app-part-1">Exercise the App Part 1</a></li>
<li><a class="reference internal" href="#investigating-an-incident">Investigating an Incident</a></li>
<li><a class="reference internal" href="#exercise-the-app-part-2">Exercise the App Part 2</a></li>
<li><a class="reference internal" href="#enforcing-file-types">Enforcing File Types</a></li>
<li><a class="reference internal" href="#testing-waf-policy">Testing WAF Policy</a></li>
<li><a class="reference internal" href="#monkeying-with-the-asm-cookie">Monkeying with the ASM Cookie</a></li>
</ul>
</li>
</ul>

         </span>
      </nav>
    </div>





  
  <div class="main active" id="content" >
    <article class="docs-container site-article-inner">
              <!-- custom breadcrumb -->
        <h5>
            <a href="../../../index.html">F5 Web Application Firewall Solutions</a>
              &gt; <a href="../../waf201.html">WAF 201 – Elevated WAF Security</a>
              &gt; <a href="../module2.html">Module 2: Intro to Positive Security</a>

          <span class="right">
             <a href="../../../_sources/waf201/module2-positive-sec/lab1/lab1.rst.txt" rel="nofollow">Source</a> |
             <a href="https://github.com/f5devcentral/f5-agility-labs-waf">Edit on <i class="fa fa-github" aria-hidden="true"></i></a>
          </span>
        </h5>
        <!-- end custom breadcrumb -->
      


    <!--a title="Export PDF" id="export-pdf" class="btn btn btn-link pull-right">View PDF</a-->
    <button type="button" id="export-pdf" class="btn btn-link right">PDF</button>


    
     
         <div class="sidebar" id="version-warning" style="display: none;">
           <p class="first sidebar-title">
           <span class="icon fa fa-info-circle fa-lg"></span> Version notice:</p>
           <p class="last" id="currentVersion"></p>
          </div>


     <div role="main">
        
  <div class="section" id="lab-2-intro-to-positive-security">
<h1>Lab 2: Intro to Positive Security<a class="headerlink" href="#lab-2-intro-to-positive-security" title="Permalink to this heading">¶</a></h1>
<p>In WAF 102, we created and tested some of the negative security aspects of the Application Security Policy including IP Intelligence Enforcement, Geolocation, Signature Based Bot Detection and a Transparent Policy focused on Attack Signatures.
If you were following along in successive fashion and building your own environment, the configurations below logically pick up in the policy right where 102 left off. We will be creating a new policy for this lab that starts with “2nd day” best-practice configurations for <strong>elevating</strong> your WAF policy up a level, but in reality, you should always start your approach as recommended in WAF 102 and build from there.</p>
<ol class="arabic simple">
<li>Navigate to <strong>Security &gt; Application Security &gt; Security Policies &gt; Policies List &gt; Create</strong> and configure a policy named <strong>juiceshop_blocking</strong>.</li>
<li>Choose Policy Template: <strong>Rapid Deployment Policy</strong>, Enforcement Mode: <strong>Blocking</strong> and click <strong>Save</strong>.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/juice_block.png"><img alt="../../../_images/juice_block.png" src="../../../_images/juice_block.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="3">
<li>Navigate to <strong>Security &gt; Application Security &gt; Policy Building &gt; Learning and Blocking Settings</strong>.</li>
<li>Under <strong>Cookies</strong> note the default settings. Uncheck <strong>Learn</strong> from <strong>Modified ASM Cookie</strong>. Generally, we do not want to allow modification of the WAF cookie and therefor will disable learning suggestions for this.</li>
<li>Under <strong>File Types</strong> note the default Learning Mode is set to <strong>Never (wildcard only)</strong> Change that to be <strong>Selective</strong> and enable <strong>Learn and Alarm</strong> for <strong>Illegal file type</strong>.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/cookies.png"><img alt="../../../_images/cookies.png" src="../../../_images/cookies.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="6">
<li>Under <strong>Headers</strong>, check the box for both Alarm and Block for <strong>Illegal host name</strong> and then it’s <strong>very important</strong> to check the bottom box for <strong>Learn Host Names</strong>.</li>
<li>Under <strong>URLS</strong>, enable <strong>Compact Mode</strong> for “Learn New HTTP URLS” instead of <strong>Never (wildcard only)</strong>. Note the description of this mode:</li>
</ol>
<p>Choose this option if you would like to create a list of top-level URL directories <code class="docutils literal notranslate"><span class="pre">(e.g.</span> <span class="pre">/abc/*)</span> <span class="pre">and</span> <span class="pre">/</span></code>, while enforcing all other URLs with a wildcard rule.</p>
<a class="reference internal image-reference" href="../../../_images/heads.png"><img alt="../../../_images/heads.png" src="../../../_images/heads.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="8">
<li>Enable Learn and Alarm for <strong>Illegal URL</strong>, click <strong>Save</strong> and <strong>Apply Policy</strong> which is back at the top right of the UI. Accept the popup and check the box for no more confirmations and then <strong>Ok</strong>.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/pop1.png"><img alt="../../../_images/pop1.png" src="../../../_images/pop1.png" style="width: 600px;" /></a>
<div class="section" id="allow-list">
<h2>Allow List<a class="headerlink" href="#allow-list" title="Permalink to this heading">¶</a></h2>
<p>Since we will be training the WAF for positive security, let’s create an allow list. This will help to create high-fidelity learning suggestions as events occur.</p>
<ol class="arabic simple">
<li>Navigate to <strong>Security &gt; Application Security &gt; Security Policies &gt; Security Policies List, then click on the “juiceshop_blocking” policy and navigate to the IP Address Exceptions menu.</strong> and click <strong>Create</strong>. Configure the allow list for a 10/8 to allow our internal “trusted” network as shown below and check the box for <strong>Policy Builder trusted IP</strong>.</li>
<li>Note in the upper left that this allow list is only associated with the <strong>juiceshop_blocking policy</strong>. Allow lists are unique per policy but could be defined at part of a parent policy and delegated down to child policies.</li>
<li>Click <strong>Create</strong> and configure your Exception properties according to the screenshot below, then click <strong>Add</strong>. Be sure to enable the <strong>Trust this IP</strong> under <strong>Policy Builder Traffic</strong>. Be sure to then click <strong>Apply Policy</strong> in the upper-right hand corner of the UI.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/ipe2in1.png"><img alt="../../../_images/ipe2in1.png" src="../../../_images/ipe2in1.png" style="width: 600px;" /></a>
<a class="reference internal image-reference" href="../../../_images/ipe.png"><img alt="../../../_images/ipe.png" src="../../../_images/ipe.png" style="width: 600px;" /></a>
</div>
<div class="section" id="configure-the-virtual-server">
<h2>Configure the Virtual Server<a class="headerlink" href="#configure-the-virtual-server" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li>Navigate to  <strong>Local Traffic &gt; Virtual Servers &gt; owasp-juiceshop_443_vs &gt; Security &gt; Policies</strong>.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For Demo purposes, we will be removing the Bot Defense Profile to exclusively test the blocking Application Security Policy. In the “real world” these profiles complement each other by providing a layered defense for your application.</p>
</div>
<ol class="arabic simple" start="2">
<li><strong>Enable</strong> the Application Security Policy <strong>juiceshop-blocking</strong>.</li>
<li><strong>Disable</strong> the Bot Defense profile.</li>
<li><strong>Move</strong> the Balanced_Bot_Log from <strong>Selected</strong> to <strong>Available</strong> and move the <strong>Log all requests</strong> profile over to <strong>Selected</strong> and click <strong>Update</strong>.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/virt.png"><img alt="../../../_images/virt.png" src="../../../_images/virt.png" style="width: 600px;" /></a>
</div>
<div class="section" id="exercise-the-app-part-1">
<h2>Exercise the App Part 1<a class="headerlink" href="#exercise-the-app-part-1" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li>Close any existing Juice Shop tabs in the browser and open a new one to the <strong>OWASP Juice Shop</strong> bookmark.</li>
<li><strong>Request Rejected!!!</strong> What Happened?</li>
</ol>
</div>
<div class="section" id="investigating-an-incident">
<h2>Investigating an Incident<a class="headerlink" href="#investigating-an-incident" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li>Click back on the <strong>Advanced WAF</strong> tab and navigate to <strong>Security &gt; Event Logs &gt; Application &gt; Requests</strong> and review the blocked events. In both cases it was an illegal hostname due to the checks that we enabled under <strong>Headers</strong> in <strong>Learning and Blocking Settings</strong> just moments ago.</li>
<li>The problem is that we enabled checking for a hostname but haven’t defined what that hostname is yet. This exercise is to draw your attention to the importance of understanding what you are enabling in Learning and Blocking Settings and how to quickly resolve an issue. We can easily add the hostname.</li>
<li>Navigate to <strong>Security &gt; Application Security &gt; Policy Building &gt; Traffic Learning</strong> and note the learning suggestions and score. You will see suggestions to add the top-level URL and a Valid Hostname.  All of the others involve enabling various checks for evasion techniques and http protocol compliancy, which are generally a good idea to enable.</li>
<li>Click the box to <strong>Select All</strong> suggestions and click <strong>Accept &gt; Accept suggestions</strong> and <strong>Apply Policy</strong>.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/learn.png"><img alt="../../../_images/learn.png" src="../../../_images/learn.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="5">
<li>Navigate to <strong>Security &gt; Application Security &gt; Headers &gt; Host Names</strong> to review the hostname that was configured when you accepted the learning suggestion.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/host.png"><img alt="../../../_images/host.png" src="../../../_images/host.png" style="width: 600px;" /></a>
</div>
<div class="section" id="exercise-the-app-part-2">
<h2>Exercise the App Part 2<a class="headerlink" href="#exercise-the-app-part-2" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li>Go back to the Juice Shop tab and do a [Shft + Refresh].</li>
<li>If you are continuing with the same deployment from the 102 class, skip to Step 4, else click <strong>Account &gt; Login</strong> in the top right and then click <strong>Not yet a customer</strong> on the login form.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/account.png"><img alt="../../../_images/account.png" src="../../../_images/account.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="3">
<li>Use <strong>f5student&#64;f5agility.com</strong> for email address and the same password you’ve been using for the labs. Select and complete any of the Security Questions and click <strong>Register</strong>.</li>
<li>Login with the new account, click on the <strong>Apple Juice</strong> and leave a short review and click <strong>Submit</strong>.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/feedback.png"><img alt="../../../_images/feedback.png" src="../../../_images/feedback.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="5">
<li>In the Advanced WAF tab navigate to <strong>Security &gt; Event Logs &gt; Application &gt; Requests</strong> and you will see a blocked event for the review you just left.</li>
<li>Click on the blocked event and review the Violation. This is an <strong>Illegal method</strong> violation due to “PUT” being used as the command to leave feedback. “PUT” is not a default allowed HTTP command per the Rapid Deployment Policy Template.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/badreview.png"><img alt="../../../_images/badreview.png" src="../../../_images/badreview.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="7">
<li>Click the <strong>Accept</strong> button which will add “PUT” to the <strong>Allowed Methods</strong> in <strong>Security &gt; Application Security &gt; Headers &gt; Methods</strong>.</li>
<li>Navigate to <strong>Security &gt; Application Security &gt; Headers &gt; Methods</strong> to review the addition and click <strong>Apply Policy</strong>.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/put1.png"><img alt="../../../_images/put1.png" src="../../../_images/put1.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="9">
<li>Go back to Juice Shop and test leaving a review again. From the left hamburger menu start a support chat and test leaving a complaint.</li>
<li>Navigate to <strong>Security &gt; Event Logs &gt; Application &gt; Requests</strong> and you should see all <strong>Allowed Requests</strong> at this point. If you, by rare chance, see a blocked request, take steps similar to the previous to resolve the issue by <strong>Accepting</strong> the blocked request.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/allowed.png"><img alt="../../../_images/allowed.png" src="../../../_images/allowed.png" style="width: 600px;" /></a>
<p><strong>This is how to train a WAF - by ferreting out any false positives early on. It’s also an important example of you why it’s critical to get your policies developed from trusted sources during the testing phases of application development.</strong></p>
</div>
<div class="section" id="enforcing-file-types">
<h2>Enforcing File Types<a class="headerlink" href="#enforcing-file-types" title="Permalink to this heading">¶</a></h2>
<p>File types are low-hanging fruit from a positive security perspective and a great starting point for enhancing your security policy by allowing or disallowing access to known file types or extensions. We will enable Compact mode learning to create a learned list of common file types and enforce against a pre-populated list of disallowed file types.</p>
<ol class="arabic simple">
<li>Navigate to <strong>Security &gt; Application Security &gt; Policy Building &gt; Learning and Blocking Settings &gt; File Types</strong> and change the default learning mode from <strong>Selective</strong> to <strong>Compact</strong> and read the description.</li>
<li>Click <strong>Save</strong> and <strong>Apply Policy</strong>.</li>
<li>Go back to the Juice Shop tab and browse to the <strong>Photo Wall</strong> via the “Hamburger Menu” at the top left.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/ham.png"><img alt="../../../_images/ham.png" src="../../../_images/ham.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="4">
<li>In Advanced WAF go to <strong>Security &gt; Application Security &gt; Policy Building &gt; Traffic Learning</strong> and notice the new file type learning suggestions.</li>
<li>Review and then select all of the new suggestions and click <strong>Accept &gt; Accept Suggestions</strong> and <strong>Apply Policy</strong>. There may be additional suggestions that you can safely accept.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/fileaccept.png"><img alt="../../../_images/fileaccept.png" src="../../../_images/fileaccept.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="6">
<li>Navigate to <strong>Security &gt; Application Security &gt; Policy Building &gt; Security Policies &gt; Security Policies List</strong>, click on <strong>juiceshop_blocking</strong> policy, then navigate to <strong>HTTP Message Protection &gt; File Types</strong> within the policy to review what was added. You can also observe other availabe file types available for enforcement.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/filetypes.png"><img alt="../../../_images/filetypes.png" src="../../../_images/filetypes.png" style="width: 600px;" /></a>
</div>
<div class="section" id="testing-waf-policy">
<h2>Testing WAF Policy<a class="headerlink" href="#testing-waf-policy" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li>On the Linux Client desktop launch Burp Suite Community Edition. <strong>DO NOT click multiple times. It takes a few moments to load on first launch</strong>.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/burp1.png"><img alt="../../../_images/burp1.png" src="../../../_images/burp1.png" style="width: 60px;" /></a>
<ol class="arabic simple" start="2">
<li>Take the default setting of <strong>Temporary project</strong> by clicking <strong>Next</strong> and then click <strong>Start Burp</strong> with the default settings. <strong>Do not accept any offers to update/restart the software</strong>.</li>
<li>Click on the <strong>Proxy</strong> tab and click on the “blue” <strong>Intercept is on</strong> button to turn it off.</li>
<li>Click the <strong>Open Browser</strong> button and <strong>wait for several moments</strong> for the built-in Burp Browser to open. Your setup should look like this:</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/browser.png"><img alt="../../../_images/browser.png" src="../../../_images/browser.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="5">
<li>In the Burp browser paste in: <code class="docutils literal notranslate"><span class="pre">https://juiceshop.f5agility.com/</span></code> but do <strong>NOT</strong> hit the Return key yet.</li>
<li>Back in Burp Console click on <strong>Intercept is off</strong> button to turn it back on.</li>
<li>In Burp browser click in the whitespace of the URL bar twice so the URL is NOT highlighted and hit the <strong>Return</strong> key on your keyboard to send the request for <code class="docutils literal notranslate"><span class="pre">https://juiceshop.f5agility.com/</span></code>.</li>
<li>You will notice Burp Console will popover the browser with the intercepted request. You can now decide which actions to take real-time before sending the requests.</li>
</ol>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">You may see some requests mixed in that are Google related (www.gstatic.com, googleapis.com, etc). These are produced automatically by the browser and you can safely forward them until you get to the request for <a class="reference external" href="https://juiceshop.f5agility.com">https://juiceshop.f5agility.com</a>.</p>
</div>
<a class="reference internal image-reference" href="../../../_images/burpjuice.png"><img alt="../../../_images/burpjuice.png" src="../../../_images/burpjuice.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="9">
<li>Go ahead and choose to <strong>Forward</strong> that request.</li>
<li>As you can see Burp is a very powerful proxy that allows you to view each request as it is being made and potentially insert or modify that request before sending.</li>
<li>Click on <strong>Intercept is on</strong> to turn it off so the rest of the requests load and then click it again to turn it back on so that it reads <strong>Intercept is on</strong>.</li>
<li>Back in the Burp Browser the page should have loaded from the previous requests so just click the <strong>Refresh</strong> button in the browser and <strong>Dismiss</strong> the popup.</li>
<li>You can use any of the <strong>GET</strong> requests for <strong>Host: juiceshop.f5agility.com</strong>. Simply forward any of the aforementioned Google related requests should they pop up.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/defaultpage.png"><img alt="../../../_images/defaultpage.png" src="../../../_images/defaultpage.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="14">
<li>Modify the request to fetch an evilfile.exe file from the server and click <strong>Forward</strong>.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/evilfile.png"><img alt="../../../_images/evilfile.png" src="../../../_images/evilfile.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="15">
<li>In Advanced WAF, navigate to <strong>Security &gt; Event Logs &gt; Application &gt; Requests</strong> and review the alert. Was it blocked?</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/evilalert.png"><img alt="../../../_images/evilalert.png" src="../../../_images/evilalert.png" style="width: 600px;" /></a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Even though policy is in blocking mode, individual elements can be very granularly configured to Alarm or Block. In practice you could have a Blocking policy with everything in set in Learning and Blocking settings to only “Alarm”. You can then methodically enable blocking for each individual element and validate the application. This gives you the utmost flexibility when moving from a Transparent to Blocking policy.</p>
</div>
<ol class="arabic simple" start="16">
<li>Navigate to <strong>Security &gt; Application Security &gt; Policy Building &gt; Learning and Blocking Settings &gt; File Types</strong> and enable <strong>Block</strong> for <strong>Illegal file type</strong>.</li>
<li>Click <strong>Save</strong> and <strong>Apply Policy</strong>.</li>
</ol>
<ol class="arabic simple" start="17">
<li>Back in Burp Console modify another request for <strong>evilfile.exe</strong> again and click <strong>Forward</strong>. Just delete whatever URI is currently being called and replace it with <code class="docutils literal notranslate"><span class="pre">evilfile.exe</span></code> <strong>Make sure the Host is set to juiceshop.f5agility.com and not a google site. If it is related to google just click forward until you get to the next juiceshop.f5agility.com “Host” request</strong>.</li>
<li>Navigate to <strong>Security &gt; Event Logs &gt; Application &gt; Requests</strong> and review the alert. Was it blocked this time?</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/evilblock.png"><img alt="../../../_images/evilblock.png" src="../../../_images/evilblock.png" style="width: 600px;" /></a>
</div>
<div class="section" id="monkeying-with-the-asm-cookie">
<h2>Monkeying with the ASM Cookie<a class="headerlink" href="#monkeying-with-the-asm-cookie" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li>Back in Burp Console make sure you are looking at a request for Host <strong>juiceshop.f5agility.com</strong>. If not, click  forward until you find one.</li>
<li>Under <strong>Cookie</strong> notice at least 3 cookies.</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>language (used to set language pref in the browser).</li>
<li>io (Juice Shop session cookie).</li>
<li>TS (Set by Advanced WAF and will always be a unique identifier).</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="3">
<li>Add an extra character (7) to the end of the TS cookie value and click <strong>Forward</strong>.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/modified.png"><img alt="../../../_images/modified.png" src="../../../_images/modified.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="4">
<li>Navigate to <strong>Security &gt; Event Logs &gt; Application &gt; Requests</strong> and review the alert.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/modified1.png"><img alt="../../../_images/modified1.png" src="../../../_images/modified1.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="5">
<li>Back in Burp Console make sure you are looking at a request for Host <strong>juiceshop.f5agility.com</strong>. If not, click  forward until you find one.</li>
<li>Change the host to the IP address of the Virtual Server: <strong>10.1.10.145</strong> and click <strong>Forward</strong>.</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/iphost.png"><img alt="../../../_images/iphost.png" src="../../../_images/iphost.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="7">
<li>Close Burp.</li>
<li>Back in Advanced WAF, refresh <strong>Security &gt; Event Logs &gt; Application &gt; Requests</strong> and review the alert. What was the violation? How could you add it to the allowed hostnames if required?</li>
</ol>
<p><strong>This lab was designed to give you the tools and strategies for building and managing a more complex or “Day 2” WAF policy. You now know how to turn on and test some positive security features that can be used to enhance and “elevate” your application security posture.</strong></p>
<p><strong>This concludes Lab 2.</strong></p>
</div>
</div>


     </div>
    
     <div class="row next-prev-btn-row">
       <div class="col-lg-12">
       
        <a href="../module2.html" title="Module 2: Intro to Positive Security" accesskey="p" class="btn btn-primary left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
       
       
          <a href="../../module3-L7-dos/module3.html" title="Module 3: Layer 7 DoS Protection" accesskey="n" class="btn btn-primary right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
       
     </div>
     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../../_static/js/index.js"></script>
  <script src="../../../_static/js/jquery.appear.js"></script>
  <script src="../../../_static/js/printThis.js"></script>
  <script src="../../../_static/js/bootstrap.min.js"></script>
  <script src="../../../_static/js/clouddocs.js"></script>
  <script src="../../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
  </body>
</html>