<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>Lab 3.5 Enhance Security with AWAF Features</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="Lab 3.5 Enhance Security with AWAF Features"/>
  <meta name="product" content="F5 Web Application Firewall Solutions"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="2023-05-04 07:11:03"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="F5 Web Application Firewall Solutions" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lab 3.5 Enhance Security with AWAF Features &#8212; F5 Web Application Firewall Solutions  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/f5.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/f5-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/CoveoFullSearch.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/21fb8a09c3.css" type="text/css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="WAF 341 – Advanced Protection and Positive Security (Self Guided)" href="../../waf341/waf341.html" />
    <link rel="prev" title="Lab 3.4: Add Money Transfer Service to an OpenAPI File" href="lab4.html" /> 
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="sidebar" class="section-nav">
      
      <!--  version selector ------------------>
      <div id="version_selector_wrapper">
      </div>
      <nav class="nav-sidebartoc">

        
         <h5>F5 Web Application Firewall Solutions  </h5>
        

        <hr>
        <span class="nav-sidebartoc">
            <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../waf102/waf102.html">WAF 102 - Getting started with WAF, Bot Detection and Threat Campaigns</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../waf111/waf111.html">WAF 111 - Protecting Yourself Against the OWASP Top 10</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../waf201/waf201.html">WAF 201 – Elevated WAF Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../waf2023/waf2023.html">WAF 101 - BIG-IP Security:  Mitigating App Vulnerabilities with AWAF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../waf301/waf301.html">WAF 301 - AWAF in a CI/CD Pipeline (Self Guided)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../waf302.html">WAF 302 - Enabling API Protection with APM and AWAF</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../waf302.html#intro">Intro</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../waf302.html#lab-scenario">Lab Scenario</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../labinfo/labinfo.html">Lab Environment &amp; Topology</a></li>
<li class="toctree-l3"><a class="reference internal" href="../module1-petstore/module1.html">Module 1 - API Protection Using APM oAuth</a></li>
<li class="toctree-l3"><a class="reference internal" href="../module2-arcadiareview/module2.html">Module 2: AWAF Policy Template Creation on BIG-IP (secops engineer)</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="module3.html">Module 3: Deploying a development instance of Arcadia Finance</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../waf341/waf341.html">WAF 341 – Advanced Protection and Positive Security (Self Guided)</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


    <div id="right-sidebar">
      <h7 style="font-weight:normal">On this page:</h7>
      <nav class="nav-sidebartoc">
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">Lab 3.5 Enhance Security with AWAF Features</a><ul>
<li><a class="reference internal" href="#task-1-attack-a-parameter">Task 1 – Attack a Parameter</a></li>
<li><a class="reference internal" href="#task-2-encode-the-attack-and-try-again">Task 2 – Encode the Attack and Try Again</a></li>
<li><a class="reference internal" href="#task-3-tune-the-bigip-security-policy">Task 3 – Tune the BigIP Security Policy</a></li>
</ul>
</li>
</ul>

         </span>
      </nav>
    </div>





  
  <div class="main active" id="content" >
    <article class="docs-container site-article-inner">
              <!-- custom breadcrumb -->
        <h5>
            <a href="../../index.html">F5 Web Application Firewall Solutions</a>
              &gt; <a href="../waf302.html">WAF 302 - Enabling API Protection with APM and AWAF</a>
              &gt; <a href="module3.html">Module 3: Deploying a development instance of Arcadia Finance</a>

          <span class="right">
             <a href="../../_sources/waf302/module3-deploydevdeploy/lab5.rst.txt" rel="nofollow">Source</a> |
             <a href="https://github.com/f5devcentral/f5-agility-labs-waf">Edit on <i class="fa fa-github" aria-hidden="true"></i></a>
          </span>
        </h5>
        <!-- end custom breadcrumb -->
      


    <!--a title="Export PDF" id="export-pdf" class="btn btn btn-link pull-right">View PDF</a-->
    <button type="button" id="export-pdf" class="btn btn-link right">PDF</button>


    
     
         <div class="sidebar" id="version-warning" style="display: none;">
           <p class="first sidebar-title">
           <span class="icon fa fa-info-circle fa-lg"></span> Version notice:</p>
           <p class="last" id="currentVersion"></p>
          </div>


     <div role="main">
        
  <div class="section" id="lab-3-5-enhance-security-with-awaf-features">
<h1>Lab 3.5 Enhance Security with AWAF Features<a class="headerlink" href="#lab-3-5-enhance-security-with-awaf-features" title="Permalink to this heading">¶</a></h1>
<div class="section" id="task-1-attack-a-parameter">
<h2>Task 1 – Attack a Parameter<a class="headerlink" href="#task-1-attack-a-parameter" title="Permalink to this heading">¶</a></h2>
<p>In Postman, select the <em>Arcadia Finance</em> &gt;&gt; <em>Dev</em> &gt;&gt; <em>Test API</em> &gt;&gt; <em>transfer money</em> request again.
Since we know the “friend” parameter is accepting alpha-numeric values, and there is a MongoDB backend, let’s see if we can sneak in a NoSQL Injection to our MongoDB</p>
<p>Change the friend value from Bart to the following and click Send</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>db.collection.find({ $where: function() {return (this.product == ‘m’; sleep (10000)) }});
</pre></div>
</div>
<img alt="../../_images/postman-samplemongodbexploit.png" src="../../_images/postman-samplemongodbexploit.png" />
<p>Predictably, we are blocked for a NoSQL Injection</p>
</div>
<div class="section" id="task-2-encode-the-attack-and-try-again">
<h2>Task 2 – Encode the Attack and Try Again<a class="headerlink" href="#task-2-encode-the-attack-and-try-again" title="Permalink to this heading">¶</a></h2>
<p>1. Open Chrome and go to the Base64 Encode bookmark
Encode your NoSQL Injection string and copy the results</p>
<img alt="../../_images/chrome-base64encode.png" src="../../_images/chrome-base64encode.png" />
<ol class="arabic simple" start="2">
<li>Now in the Money Transfer request, change “friend” to the new encoded string and <strong>Send</strong></li>
</ol>
<img alt="../../_images/postman-base64encoded.png" src="../../_images/postman-base64encoded.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<img alt="../../_images/meme-surpriseddog.png" src="../../_images/meme-surpriseddog.png" />
<p>Unfortunately, this type of security is not something OpenAPI has a spec for. To protect your API against base64 encoded attacks, you would need to enable a WAF-specific feature on the parameter.</p>
</div>
<div class="section" id="task-3-tune-the-bigip-security-policy">
<h2>Task 3 – Tune the BigIP Security Policy<a class="headerlink" href="#task-3-tune-the-bigip-security-policy" title="Permalink to this heading">¶</a></h2>
<p>1. Go to the Arcadia dev security policy &gt; allowed URLs &gt; money transfer &gt; URL Parameters
Click the “friend” parameter and enable Base64 decoding</p>
<img alt="../../_images/big-ip-security-enablebase64.png" src="../../_images/big-ip-security-enablebase64.png" />
<ol class="arabic simple" start="2">
<li>Click <em>Update</em> and then <strong>Apply the Policy</strong></li>
</ol>
<p>Go back to Postman and re-send the same request with encoded “friend” parameter
Check the security logs - The parameter value is now decoded and flagged as a violation.</p>
<p>It’s important to note that changes outside of AS3 will not persist if this VIP is re-deployed. This is just an example of what’s possible. What you can do is customize the policy however you need and then export the entire policy as JSON and reference that in your AS3 declaration as an updated version.</p>
<p>You can do this from the Security Policies screen by clicking on your arcadia policy and then find the Export button at the top left.</p>
<img alt="../../_images/big-ip-security-export.png" src="../../_images/big-ip-security-export.png" />
<p>Consider the OpenAPI file as a security starting point that will get you enforcement and OWASP protection. For many organizations, that will be enough.</p>
<p>Time for a well-deserved break!  This concludes the Arcadia OpenAPI Security Lab.</p>
</div>
</div>


     </div>
    
     <div class="row next-prev-btn-row">
       <div class="col-lg-12">
       
        <a href="lab4.html" title="Lab 3.4: Add Money Transfer Service to an OpenAPI File" accesskey="p" class="btn btn-primary left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
       
       
          <a href="../../waf341/waf341.html" title="WAF 341 – Advanced Protection and Positive Security (Self Guided)" accesskey="n" class="btn btn-primary right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
       
     </div>
     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../_static/js/index.js"></script>
  <script src="../../_static/js/jquery.appear.js"></script>
  <script src="../../_static/js/printThis.js"></script>
  <script src="../../_static/js/bootstrap.min.js"></script>
  <script src="../../_static/js/clouddocs.js"></script>
  <script src="../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
  </body>
</html>